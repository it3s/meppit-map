(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z={}.hasOwnProperty,A=function(a,b){function c(){this.constructor=a}for(var d in b)z.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},B=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};null==window.Meppit&&(window.Meppit={}),window.Meppit.VERSION="0.3.0",p=Meppit.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},q=Meppit.isNumber=function(a){return"number"==typeof a},r=Meppit.isString=function(a){return"string"==typeof a},o=Meppit.interpolate=function(a,b){return a.replace(/#{([^#{}]*)}/g,function(a,c){var d;return d=b[c],r(d)||q(d)?d:a})},m=Meppit.getHash=function(a){var b,c,d,e,f;if(c=0,a.length>0)for(d=e=0,f=a.length-1;0<=f?e<=f:e>=f;d=0<=f?++e:--e)b=a.charCodeAt(d),c=(c<<5)-c+b,c|=0;return"_"+c},l=Meppit.getDate=function(a){var b,c,d,e,f;return d=["January","February","March","April","May","June","July","August","September","October","November","December"],null==a&&(a=new Date),b=a.getDate(),c=a.getMonth(),f=a.getYear(),e=f<1e3?f+1900:f,""+d[c]+" "+b+" "+e},x=Meppit.log=function(){var a;if(a=["["+l()+"]"].concat(Array.prototype.slice.call(arguments)),!window.MEPPIT_SILENCE)return"undefined"!=typeof console&&null!==console?console.log(a.join(" ")):void 0},y=Meppit.warn=function(){var a;if(a=["["+l()+"]"].concat(Array.prototype.slice.call(arguments)),!window.MEPPIT_SILENCE)return"undefined"!=typeof console&&null!==console?console.warn(a.join(" ")):void 0},w=Meppit.reverseCoordinates=function(a){var b,c;return q(a)?a:p(a)&&p(a[0])?function(){var b,d,e;for(e=[],b=0,d=a.length;b<d;b++)c=a[b],e.push(w(c));return e}():p(a)&&q(a[0])?a.reverse():("Feature"===a.type?a.geometry.coordinates=w(a.geometry.coordinates):"FeatureCollection"===a.type&&(a.features=function(){var c,d,e,f;for(e=a.features,f=[],c=0,d=e.length;c<d;c++)b=e[c],f.push(w(b));return f}()),a)},v=Meppit.requestJSON=function(a,b){var c;return c=window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void 0,null==this._requests&&(this._requests=[]),this._requests.push(c),c.onreadystatechange=function(){if(4===c.readyState)return b(200===c.status?JSON.parse(c.responseText):null)},c.open("GET",a,!0),c.send()},i=0,a=function(){function a(){this.cid=i++}return a.prototype.VERSION="0.3.0",a.prototype.log=function(){var a;return a=["Log: "+this.constructor.name+"#"+this.cid+" -"].concat(Array.prototype.slice.call(arguments)),x.apply(this,a)},a.prototype.warn=function(){var a;return a=["Warn: "+this.constructor.name+"#"+this.cid+" -"].concat(Array.prototype.slice.call(arguments)),y.apply(this,a)},a.prototype.getOption=function(a){var b,c,d;return null!=(b=null!=(c=this.options)?c[a]:void 0)?b:null!=(d=this.defaultOptions)?d[a]:void 0},a.prototype.setOption=function(a,b){return null==this.options&&(this.options={}),this.options[a]=b},a}(),Meppit.BaseClass=a,"function"==typeof define&&define([],function(){return window.Meppit}),b=function(a){function b(a,c){this.map=a,this.options=null!=c?c:{},b.__super__.constructor.apply(this,arguments),this.log("Initializing Editor Manager..."),this._applyFixes(),this._initToolbars(),this._uneditedLayerProps={}}return A(b,a),b.prototype.defaultOptions={drawControl:!1},b.prototype.edit=function(a,b){var c,d;if(d=this.map._getLeafletLayers(a)[0],null==this._currentLayer||this._currentLayer!==d)return this.done(),this._currentCallback=b,this._currentLayer=d,c=function(a){return function(){var b;if(a._currentLayer)return a._backupLayer(a._currentLayer),b=function(a){var c,d,e,f,g,h;if(a&&(null!=(e=a.editing)&&e.enable(),null!=(f=a.dragging)&&f.enable(),null!=a._layers)){g=a._layers,h=[];for(c in g)d=g[c],h.push(b(d));return h}},b(a._currentLayer),a.map.editing=!0}}(this),this._currentLayer?c():this.map.load(a,function(b){return function(){return b._currentLayer=b.map._getLeafletLayers(a)[0],c()}}(this))},b.prototype.draw=function(a,b){var c;return this.cancel(),this._currentCallback=b,this.map.editing=!0,c=Meppit.isString(a)?a:a.geometry.type,c=c.toLowerCase(),this._drawing="polygon"===c?new L.Draw.Polygon(this.map.leafletMap):"linestring"===c?new L.Draw.Polyline(this.map.leafletMap):new L.Draw.Marker(this.map.leafletMap),this.map.leafletMap.once("draw:created",function(c){return function(d){var e;return e=d.layer.toGeoJSON(),null!=a.properties&&(e.properties=a.properties),c.map.load(e),"function"==typeof b?b(e):void 0}}(this)),this._drawing.enable()},b.prototype.done=function(){var a,b;return this._currentLayer&&(null!=(a=this._currentLayer.editing)&&a.disable(),null!=(b=this._currentLayer.dragging)&&b.disable(),"function"==typeof this._currentCallback&&this._currentCallback(this._currentLayer.toGeoJSON())),this._currentCallback=this._currentLayer=void 0,this.map.editing=!1},b.prototype.cancel=function(){return this.revert(),this.done(),this.map.editing=!1},b.prototype.revert=function(){return this._revertLayer(this._currentLayer)},b.prototype._initToolbars=function(){if(this.getOption("drawControl"))return this._initEditToolbar()},b.prototype._initEditToolbar=function(){return this.drawnItems=this.map._ensureGeoJsonManager(),this.drawControl=new L.Control.Draw({edit:{featureGroup:this.drawnItems}}),this.map._addLeafletControl(this.drawControl)},b.prototype._backupLayer=function(a){var b;if(b=L.Util.stamp(a),!this._uneditedLayerProps[b]){if(a instanceof L.Polyline||a instanceof L.Polygon)return this._uneditedLayerProps[b]={latlngs:L.LatLngUtil.cloneLatLngs(a.getLatLngs())};if(a instanceof L.Marker||a instanceof L.CircleMarker)return this._uneditedLayerProps[b]={latlng:L.LatLngUtil.cloneLatLng(a.getLatLng())}}},b.prototype._revertLayer=function(a){var b;if(null!=a&&(b=L.Util.stamp(a),a.edited=!1,this._uneditedLayerProps.hasOwnProperty(b))){if(a instanceof L.Polyline||a instanceof L.Polygon)return a.setLatLngs(this._uneditedLayerProps[b].latlngs);if(a instanceof L.Marker||a instanceof L.CircleMarker)return a.setLatLng(this._uneditedLayerProps[b].latlng)}},b.prototype._applyFixes=function(){return L.Edit.CircleMarker=L.Edit.Circle.extend({_initMarkers:function(){return this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker()},_move:function(a){return this._shape.setLatLng(a)}}),L.CircleMarker.addInitHook(function(){return L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",function(){var a;if(null!=(a=this.editing)?a.enabled():void 0)return this.editing.addHooks()}),this.on("remove",function(){var a;if(null!=(a=this.editing)?a.enabled():void 0)return this.editing.removeHooks()})})},b}(Meppit.BaseClass),window.Meppit.EditorManager=b,j=["==","is","equal","equals"],s=["!=","isnt","not equal","not equals","different"],n=["in"],h=["contains","has"],t=["!","not"],u=["or"],g=["and"],k=function(a,b){var c,d,e,f,g,i,j,k;if(null==a||null==a.operator)return!0;if(d=a.operator,c=null!=(j=b[a.property])?j:b.properties[a.property],B.call(h,d)>=0&&"[object Array]"===Object.prototype.toString.call(a.value)){for(e=!0,k=a.value,g=0,i=k.length;g<i;g++)f=k[g],e=e&&null!=c&&B.call(c,f)>=0;return e}},c=function(a){function b(a,c){this.map=a,this.data=c,b.__super__.constructor.apply(this,arguments),this._initializeData(),this._featureGroup=this._createLeafletFeatureGroup(),this.refresh()}return A(b,a),b.prototype.POSITION=999,b.prototype.FILLCOLOR="#0000ff",b.prototype.STROKECOLOR="#0000ff",b.prototype.FILLOPACITY=.4,b.prototype.STROKEOPACITY=.8,b.prototype.WEIGHT=3,b.prototype.hide=function(){return this.visible=!1,this._featureGroup.eachLayer(function(a){return function(b){return a._hideLayer(b)}}(this)),this},b.prototype.show=function(){return this.visible=!0,this._featureGroup.eachLayer(function(a){return function(b){return a._showLayer(b)}}(this)),this},b.prototype.refresh=function(){return this.visible===!0?this.show():this.hide(),this._featureGroup.setStyle(this.__style),this},b.prototype.match=function(a){return(null!=a?a.feature:void 0)&&(a=a.feature),k(this.rule,a)},b.prototype.addLayer=function(a){if(!this.hasLayer(a))return this._featureGroup.addLayer(a),this._setLayerVisibility(a),this._setLayerStyle(a),this},b.prototype.hasLayer=function(a){return this._featureGroup.hasLayer(a)},b.prototype.getLayers=function(){return this._featureGroup.getLayers()},b.prototype.count=function(){return this.getLayers().length},b.prototype.removeLayer=function(a){return this._featureGroup.removeLayer(a),this},b.prototype._initializeData=function(){var a,b,c,d,e,f;return this.name=this.data.name,this.id=this.data.id,this.position=null!=(a=this.data.position)?a:this.POSITION,this.strokeColor=null!=(b=null!=(c=this.data.strokeColor)?c:this.data.stroke_color)?b:this.STROKECOLOR,this.fillColor=null!=(d=null!=(e=this.data.fillColor)?e:this.data.fill_color)?d:this.FILLCOLOR,this.rule=this.data.rule,this.visible=null==(f=this.data.visible)||f,this.__style={color:this.strokeColor,fillColor:this.fillColor,weight:this.WEIGHT,opacity:this.STROKEOPACITY,fillOpacity:this.FILLOPACITY},this},b.prototype._createLeafletFeatureGroup=function(){var a;return a=L.geoJson(),a.on("layeradd",function(a){return function(b){return a._setLayerVisibility(b.layer),a._setLayerStyle(b.layer)}}(this)),a},b.prototype._hideLayer=function(a){return this.map.leafletMap.hasLayer(a)&&this.map.leafletMap.removeLayer(a),this},b.prototype._showLayer=function(a){return this.map.leafletMap.hasLayer(a)||this.map.leafletMap.addLayer(a),this},b.prototype._setLayerStyle=function(a){return"function"==typeof a.setStyle&&a.setStyle(this.__style),this},b.prototype._setLayerVisibility=function(a){return this.visible||this._hideLayer(a),this},b}(Meppit.BaseClass),d=function(a){function b(a,c){var d;this.map=a,this.options=null!=c?c:{},b.__super__.constructor.apply(this,arguments),this.log("Initializing Groups Manager..."),this.__groups={},this.__groupsIds=[],this._createDefaultGroup(),this.loadGroups(null!=(d=this.options.groups)?d:this.options.layers)}return A(b,a),b.prototype.loadGroups=function(a){var b,c,d;if(null!=a){for(c=0,d=a.length;c<d;c++)b=a[c],this.addGroup(b);return this}},b.prototype.addGroup=function(a){var b;if(!this.hasGroup(a))return b=this._createGroup(a),this.log("Adding group '"+b.name+"'..."),this._populateGroup(b),this},b.prototype.removeGroup=function(a){var b,c,d,e;if(b=this.getGroup(a),null!=b)return this.log("Removing group '"+b.name+"'..."),c=this._getGroupId(b),d=function(){var a,b,d,f;for(d=this.__groupsIds,f=[],a=0,b=d.length;a<b;a++)e=d[a],e!==c&&f.push(e);return f}.call(this),this.__groupsIds=d,this.__groups[c]=void 0,this},b.prototype.getGroup=function(a){return a instanceof c?a:Meppit.isNumber(a)?this.__groups[a]:null!=(null!=a?a.id:void 0)?this.getGroup(a.id):void 0},b.prototype.getGroups=function(){var a,b;return b=function(){var b,c,d,e;for(d=this.__groupsIds,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(this.__groups[a]);return e}.call(this),b.push(this.__defaultGroup),b},b.prototype.hasGroup=function(a){var b;return b=this._getGroupId(a),B.call(this.__groupsIds,b)>=0},b.prototype.show=function(a){var b;return null!=(b=this.getGroup(a))&&b.show(),this},b.prototype.hide=function(a){var b;return null!=(b=this.getGroup(a))&&b.hide(),this},b.prototype.count=function(){return this.__groupsIds.length},b.prototype.addFeature=function(a){var b,c,d;return b=this._getGroupFor(a),this.log("Adding feature '"+(null!=(d=a.properties)?d.name:void 0)+"' to group '"+b.name+"'..."),c=this.map._getLeafletLayer(a),b.addLayer(c),this},b.prototype.addLayer=function(a){var b,c;return b=this._getGroupFor(a.feature),this.log("Adding feature '"+(null!=(c=a.feature.properties)?c.name:void 0)+"' to group '"+b.name+"'..."),b.addLayer(a),this},b.prototype._getGroupFor=function(a){var b,c,d,e;for(e=this.getGroups(),c=0,d=e.length;c<d;c++)if(b=e[c],b.match(a))return b;return this.__defaultGroup},b.prototype._getGroupId=function(a){return a.id},b.prototype._createGroup=function(a){var b;return b=this._getGroupId(a),this.__groupsIds.push(b),this.__groups[b]=new c(this.map,a)},b.prototype._createDefaultGroup=function(){return this.__defaultGroup=new c(this.map,{id:-1,name:"Others"}),this.__groups[-1]=this.__defaultGroup},b.prototype._populateGroup=function(a){var b,c,d,e,f,g;for(f=this.getGroups(),g=[],d=0,e=f.length;d<e;d++)b=f[d],b.position>a.position&&g.push(function(){var d,e,f,g;for(f=b.getLayers(),g=[],d=0,e=f.length;d<e;d++)c=f[d],a.match(c)?(b.removeLayer(c),g.push(a.addLayer(c))):g.push(void 0);return g}());return g},b}(Meppit.BaseClass),window.Meppit.Group=c,window.Meppit.GroupsManager=d,e=function(a){function b(a){this.options=null!=a?a:{},b.__super__.constructor.apply(this,arguments),this.log("Initializing Map"),this.editing=!1,this.buttons={},this._ensureLeafletMap(),this._ensureEditorManager(),this._ensureTileProviders(),this._ensureGeoJsonManager(),this._ensureGroupsManager(),this.__defineLeafletDefaultImagePath(),this.selectTileProvider(this.getOption("tileProvider"))}return A(b,a),b.prototype.MAXZOOM=15,b.prototype.defaultOptions={element:document.createElement("div"),zoom:14,center:[-23.5,-46.6167],tileProvider:"map",idPropertyName:"id",urlPropertyName:"url",featureURL:"#{baseURL}geo_data/#{id}",geojsonTileURL:"#{baseURL}geo_data/tile/{z}/{x}/{y}",enableEditor:!0,enablePopup:!0,enableGeoJsonTile:!1,mapboxToken:"undefined"!=typeof __testing&&null!==__testing?__testing:{__testToken:void 0}},b.prototype.destroy=function(){return this.leafletMap.remove()},b.prototype.load=function(a,b){var c,d,e,f,g,h,i,j,k;if(Meppit.isNumber(a))this.load(this.getURL(a),b);else if(Meppit.isString(a))Meppit.requestJSON(a,function(a){return function(c){return c?a.load(c,b):"function"==typeof b?b(null):void 0}}(this));else if(Meppit.isArray(a))for(c=0,g={type:"FeatureCollection",features:[]},h=0,j=a.length;h<j;h++)d=a[h],this.load(d,function(d){if(c++,g.features.push(d),c===a.length)return"function"==typeof b?b(g):void 0});else{for(f=this._getLeafletLayers(a),i=0,k=f.length;i<k;i++)e=f[i],this._removeLeafletLayer(e);this._geoJsonManager.addData(a),"function"==typeof b&&b(a)}return this},b.prototype.show=function(a,b){return this.load(a,function(a){return function(c){return a.fit(c),"function"==typeof b?b(c):void 0}}(this)),this},b.prototype.toGeoJSON=function(){return this._geoJsonManager.toGeoJSON()},b.prototype.toSimpleGeoJSON=function(){var a,b,c,d,e;for(b=this._geoJsonManager.toGeoJSON(),e=b.features,c=0,d=e.length;c<d;c++)a=e[c],a.properties={};return b},b.prototype.get=function(a){var b;return null!=(b=this._getLeafletLayer(a))?b.toGeoJSON():void 0},b.prototype.remove=function(a){var b,c,d,e;for(c=this._getLeafletLayers(a),d=0,e=c.length;d<e;d++)b=c[d],this._removeLeafletLayer(b);return this},b.prototype.edit=function(a,b){var c;return this.closePopup(),this.panTo(a),null!=(c=this._ensureEditorManager())&&c.edit(a,b),this},b.prototype.draw=function(a,b){var c;return this.closePopup(),null!=(c=this._ensureEditorManager())&&c.draw(a,b),this},b.prototype.done=function(){var a;return null!=(a=this._editorManager)&&a.done(),this},b.prototype.cancel=function(){var a;return null!=(a=this._editorManager)&&a.cancel(),this},b.prototype.revert=function(){var a;return null!=(a=this._editorManager)&&a.revert(),this},b.prototype.addButton=function(a,b,c,d,e){var f;return null==e&&(e="topleft"),f=L.easyButton(b,c,d,""),f.options.position=e,this.leafletMap.addControl(f),this.buttons[a]=f,this},b.prototype.removeButton=function(a){var b;return b=this.buttons[a],b&&this.leafletMap.removeControl(b),this.buttons[a]=void 0,this},b.prototype.showButton=function(a){var b;return b=this.buttons[a],b._container.style.display="",this},b.prototype.hideButton=function(a){var b;return b=this.buttons[a],b._container.style.display="none",this},b.prototype.openPopup=function(a,b){return this.openPopupAt(a,b),this},b.prototype.openPopupAt=function(a,b,c){var d;return null!=(d=this._ensurePopupManager())&&d.open(a,b,c),this},b.prototype.closePopup=function(){var a;return null!=(a=this._ensurePopupManager())&&a.close(),this},b.prototype.fit=function(a){var b;return null==a?this:(b=this._getBounds(a),null!=b&&this.leafletMap.fitBounds(b,{maxZoom:this.MAXZOOM,animate:!1}),this)},b.prototype.panTo=function(a){var b;return null==a?this:(b=this._getBounds(a),null!=b&&this.leafletMap.panInsideBounds(b),this)},b.prototype.selectTileProvider=function(a){var b;return null!=(b=this.tileProviders[a])&&b.addTo(this.leafletMap),this.currentTileProvider=a,this},b.prototype.clear=function(){return this._geoJsonManager.clearLayers(),this.leafletLayers={},this},b.prototype.getZoom=function(){return this.leafletMap.getZoom.apply(this.leafletMap,arguments)},b.prototype.setZoom=function(){return this.leafletMap.setZoom.apply(this.leafletMap,arguments),this},b.prototype.zoomIn=function(){return this.leafletMap.zoomIn.apply(this.leafletMap,arguments),this},b.prototype.zoomOut=function(){return this.leafletMap.zoomOut.apply(this.leafletMap,arguments),this},b.prototype.showLayer=function(a){return this._groupsManager.show.apply(this._groupsManager,arguments),this},b.prototype.hideLayer=function(a){return this._groupsManager.hide.apply(this._groupsManager,arguments),this},b.prototype.addLayer=function(a){return this._groupsManager.addGroup.apply(this._groupsManager,arguments),this},b.prototype.getLayers=function(){return this._groupsManager.getGroups.apply(this._groupsManager,arguments)},b.prototype.getURL=function(a){var b,c;return b=null!=a&&null!=(c=a.properties)?c[this.getOption("urlPropertyName")]:void 0,null!=b?b:(b=Meppit.interpolate(this.getOption("featureURL"),{baseURL:this._getBaseURL()}),Meppit.interpolate(b,{id:this._getGeoJSONId(a)}))},b.prototype.refresh=function(){return this.leafletMap._onResize(),this},b.prototype.locate=function(a,b,c){var d,e,f,g;return null==c&&(c=5e3),d=null,e=function(){var a;return a=L.GeoIP.getPosition(),null!=a&&0!==a.lat&&0!==a.lng&&(g({latlng:a,bounds:L.latLngBounds([[a.lat-.05,a.lng-.05],[a.lat+.05,a.lng+.05]])}),!0)},g=function(b){var c,e,f;return clearTimeout(d),c=b.bounds?[[b.bounds.getWest(),b.bounds.getSouth()],[b.bounds.getEast(),b.bounds.getNorth()]]:void 0,e=b.latlng?[b.latlng.lng,b.latlng.lat]:void 0,f=e?{type:"Feature",bbox:c,geometry:{type:"Point",coordinates:e}}:void 0,a({location:f,accuracy:b.accuracy,altitude:b.altitude,heading:b.heading,speed:b.speed,timestamp:b.timestamp})},f=function(a){if(clearTimeout(d),!e())return b(a)},a&&this.leafletMap.once("locationfound",g),b&&this.leafletMap.once("locationerror",f),this.leafletMap.once("locationfound locationerror",function(a){return function(){return a.leafletMap.off("locationfound",g),a.leafletMap.off("locationerror",f)}}(this)),this.leafletMap.locate({setView:!0,maxZoom:this.MAXZOOM}),d=setTimeout(function(){return e()},c),this},b.prototype._getBounds=function(a){var b,c,d,e,f;if(d=this._getLeafletLayers(a),b=void 0,d.length>0)for(e=0,f=d.length;e<f;e++)c=d[e],null!=c&&(null!=c.getBounds?(null==b&&(b=c.getBounds()),b.extend(c.getBounds())):null!=c.getLatLng&&(null==b&&(b=L.latLngBounds([c.getLatLng()])),b.extend(c.getLatLng())));else a.bbox&&(b=L.latLngBounds([[L.latLng(a.bbox[0][1],a.bbox[0][0])],[L.latLng(a.bbox[1][1],a.bbox[1][0])]]));return b},b.prototype._getBaseURL=function(){var a,b,c;return b=document.getElementsByTagName("base"),a="index.html",c=this.getOption("baseURL"),null!=c?c:b.length>0?b[0].href.replace(a,""):location.protocol+"//"+location.hostname+(""!==location.port?":"+location.port:"")+"/"},b.prototype._getGeoJsonTileURL=function(){return Meppit.interpolate(this.getOption("geojsonTileURL"),{baseURL:this._getBaseURL()})},b.prototype._ensureLeafletMap=function(){return null==this.element&&(this.element=Meppit.isString(this.getOption("element"))?document.getElementById(this.getOption("element")):this.getOption("element")),null!=this.leafletMap?this.leafletMap:this.leafletMap=new L.Map(this.element,this.__getLeafletMapOptions())},b.prototype._ensureGeoJsonManager=function(){var a,b,c,d;if(null==this.leafletLayers&&(this.leafletLayers={}),a=function(a){return function(b,c){return a.__saveFeatureLayerRelation(b,c),a.__addLayerEventListeners(b,c)}}(this),d=function(a){return function(){}}(this),c=function(a){return function(a,b){return L.circleMarker(b,{weight:5,radius:7})}}(this),b={style:d,onEachFeature:a,pointToLayer:c},null==this._geoJsonManager&&(this._geoJsonManager=new L.GeoJSON([],b).addTo(this.leafletMap)),this._geoJsonManager.on("layeradd",function(a){return function(b){return a.__addLayerToGroups(b.layer)}}(this)),this.getOption("enableGeoJsonTile"))return null!=this.__geoJsonTileLayer?this.__geoJsonTileLayer:this.__geoJsonTileLayer=new L.TileLayer.GeoJSON(this._getGeoJsonTileURL(),{unique:function(a){return function(b){return a._getGeoJSONId(b)}}(this)},this).addTo(this.leafletMap)},b.prototype._ensureGroupsManager=function(){var a;return null==this._groupsManager&&(this._groupsManager=null!=(a="function"==typeof Meppit.GroupsManager?new Meppit.GroupsManager(this,this.options):void 0)?a:this.warn("Groups manager have not been loaded")),this._groupsManager},b.prototype._ensureEditorManager=function(){var a;return this.getOption("enableEditor")?(null==this._editorManager&&(this._editorManager=null!=(a="function"==typeof Meppit.EditorManager?new Meppit.EditorManager(this,this.options):void 0)?a:this.warn("Editor manager have not been loaded")),this._editorManager):void this.warn("Editor manager have been disabled")},b.prototype._ensurePopupManager=function(){var a;return this.getOption("enablePopup")?(null==this._popupManager&&(this._popupManager=null!=(a="function"==typeof Meppit.PopupManager?new Meppit.PopupManager(this,this.options):void 0)?a:this.warn("Popup manager have not been loaded")),this._popupManager):void this.warn("Popup manager have been disabled")},b.prototype._ensureTileProviders=function(){var a,b;return null==this.tileProviders&&(this.tileProviders={}),null==(a=this.tileProviders).map&&(a.map=new L.TileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:this.getOption("mapboxToken")})),null==(b=this.tileProviders).satellite&&(b.satellite=new L.TileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.satellite",accessToken:this.getOption("mapboxToken")})),this.tileProviders},b.prototype._addLeafletControl=function(){return this.leafletMap.addControl.apply(this.leafletMap,arguments)},b.prototype._getGeoJSONId=function(a){var b;return Meppit.isNumber(a)?a:(null!=(b=a.properties)?b[this.getOption("idPropertyName")]:void 0)||a[this.getOption("idPropertyName")]},b.prototype._getGeoJSONHash=function(a){return Meppit.getHash(JSON.stringify(a))},b.prototype._getLeafletLayers=function(a){var b,c,d;return c="FeatureCollection"===a.type?a.features.slice():[a],d=function(){var a,d,e;for(e=[],a=0,d=c.length;a<d;a++)b=c[a],e.push(this._getLeafletLayer(b));return e}.call(this),1===d.length&&void 0===d[0]?[]:d},b.prototype._getLeafletLayer=function(a){var b;return Meppit.isNumber(a)||Meppit.isString(a)?this.leafletLayers[a]:null!=a?this._getLeafletLayer(null!=(b=this._getGeoJSONId(a))?b:this._getGeoJSONHash(a)):void 0},b.prototype._removeLeafletLayer=function(a){var b,c;if(null!=a)return this._geoJsonManager.removeLayer(a),this.__clearLayerEventListeners(a),b=a.toGeoJSON(),null!=(c=this.leafletLayers)?c[this._getGeoJSONId(null!=b?b:this._getGeoJSONHash(b))]=void 0:void 0},b.prototype.__addLayerEventListeners=function(a,b){return b.on("click",function(b){return function(c){return b.openPopupAt(a,void 0,c.latlng)}}(this))},b.prototype.__clearLayerEventListeners=function(a){return a.off("click")},b.prototype.__getLeafletMapOptions=function(){return{center:this.getOption("center"),zoom:this.getOption("zoom")}},b.prototype.__saveFeatureLayerRelation=function(a,b){var c,d,e;return c=null!=(d=null!=(e=a.properties)?e.id:void 0)?d:this._getGeoJSONHash(a),this.leafletLayers[c]=b},b.prototype.__defineLeafletDefaultImagePath=function(){var a,b,c,d,e,f,g,h;if(null==L.Icon.Default.imagePath){for(e=document.getElementsByTagName("script"),b=/[\/^]meppit-map[\-\._]?([\w\-\._]*)\.js\??/,a="/assets",g=0,h=e.length;g<h;g++)if(d=e[g],f=d.src,f.match(b)){c=f.split(b)[0],a=(c?c+"/":"")+"images";break}return L.Icon.Default.imagePath=a}},b.prototype.__addLayerToGroups=function(a){return this._groupsManager.addLayer(a)},b}(Meppit.BaseClass),window.Meppit.Map=e,f=function(a){function b(a,b){this.map=a,this.options=b,this._createPopup()}return A(b,a),b.prototype.defaultOptions={popupTemplate:'<h1 class="title"><a href="#{url}">#{name}</a></h1>'},b.prototype.open=function(a,b,c){var d;if(!this.map.editing&&(d=this.map._getLeafletLayer(a),null!=d))return null==c&&(c=null!=d.getLatLng?d.getLatLng():null!=d.getBounds?d.getBounds().getCenter():void 0),this._popup.setLatLng(c),this._popup.setContent(null!=b?b:this._getContent(d.toGeoJSON())),this._popup.openOn(this.map.leafletMap)},b.prototype.close=function(){return this.map.leafletMap.closePopup(this._popup)},b.prototype._getContent=function(a){var b,c,d,e;return a?(c=null!=(d=null!=(e=a.properties)?e.popupContent:void 0)?d:this.getOption("popupTemplate"),b=Meppit.interpolate(c,a.properties),b=Meppit.interpolate(b,{url:this.map.getURL(a)})):""},b.prototype._createPopup=function(){return this._popup=new L.Popup},b}(Meppit.BaseClass),window.Meppit.PopupManager=f}).call(this);
//# sourceMappingURL=meppit-map.min.map